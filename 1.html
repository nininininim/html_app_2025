<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>7초 타이머 도전</title>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
			font-family: 'Segoe UI', Arial, sans-serif;
		}
		.container {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			width: 100vw;
			height: 100vh;
			background: rgba(255,255,255,0.13);
		}
		.timer {
			font-size: 3.2em;
			font-weight: bold;
			color: #222;
			margin-bottom: 32px;
			letter-spacing: 2px;
			text-shadow: 0 2px 8px #fff6;
		}
		.result {
			font-size: 1.5em;
			font-weight: bold;
			margin-top: 28px;
			color: #e53935;
			min-height: 2em;
		}
		.stop-btn {
			background: linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%);
			color: #fff;
			border: none;
			border-radius: 8px;
			padding: 16px 48px;
			font-size: 1.2em;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 8px #0002;
			transition: background 0.2s, transform 0.1s;
		}
		.stop-btn:active {
			background: linear-gradient(90deg, #6dd5ed 0%, #2193b0 100%);
			transform: scale(0.97);
		}
	</style>
</head>
<body>
	<div class="container">
		<canvas id="fireworks" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;display:none;"></canvas>
		<div class="timer" id="timer">0.00</div>
		<button class="stop-btn" id="stopBtn">멈추기</button>
		<button class="stop-btn" id="retryBtn" style="margin-top:12px; background:linear-gradient(90deg,#43e97b 0%,#38f9d7 100%);">다시하기</button>
		<div class="result" id="result"></div>
	</div>
	<script>
		let startTime = null;
		let timerTimeout = null;
		let stopped = false;

		function pad(num, len) {
			return num.toString().padStart(len, '0');
		}

		function updateTimer() {
			if (stopped) return;
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed >= 10) {
				elapsed = 10;
				document.getElementById('timer').textContent = '10.00';
				document.getElementById('result').textContent = '시간초과';
				document.getElementById('stopBtn').disabled = true;
				return;
			}
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			timerTimeout = setTimeout(updateTimer, 1); // 더 빠른 갱신
		}

		function startTimer() {
			startTime = performance.now();
			stopped = false;
			document.getElementById('result').textContent = '';
			document.getElementById('result').style.color = '#e53935';
			document.getElementById('stopBtn').disabled = false;
			updateTimer();
		}

		function stopTimer() {
			if (stopped) return;
			stopped = true;
			clearTimeout(timerTimeout);
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed > 10) elapsed = 10;
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			document.getElementById('stopBtn').disabled = true;
			if (sec === 7 && ms === 0) {
				document.getElementById('result').textContent = '성공!';
				document.getElementById('result').style.color = '#388e3c';
				startFireworks();
			} else {
				document.getElementById('result').textContent = '실패';
				document.getElementById('result').style.color = '#e53935';
			}
		}

		// 폭죽 효과 구현
		const fwCanvas = document.getElementById('fireworks');
		const ctx = fwCanvas.getContext('2d');
		let fireworks = [];
		let fireworkInterval = null;
		let fireworkEndTimeout = null;

		function resizeCanvas() {
			fwCanvas.width = window.innerWidth;
			fwCanvas.height = window.innerHeight;
		}
		window.addEventListener('resize', resizeCanvas);

		function randomBetween(a, b) {
			return a + Math.random() * (b - a);
		}

		function launchFirework() {
			const colors = [
				'#2196f3', '#e53935', '#43a047', '#ffd600', '#ff6f00', '#8e24aa', '#00bcd4', '#ff4081', '#fff', '#00e676'
			];
			// 화면 전체에 퍼지도록 x, y 범위 확장
			const x = randomBetween(0.05, 0.95) * fwCanvas.width;
			const y = randomBetween(0.1, 0.7) * fwCanvas.height;
			const color = colors[Math.floor(Math.random() * colors.length)];
			const particles = [];
			const count = 80 + Math.floor(Math.random() * 60); // 파티클 수 증가
			for (let i = 0; i < count; i++) {
				const angle = (2 * Math.PI * i) / count;
				const speed = randomBetween(4, 12); // 속도 증가
				particles.push({
					x, y,
					vx: Math.cos(angle) * speed,
					vy: Math.sin(angle) * speed,
					alpha: 1,
					color,
					radius: randomBetween(3, 8), // 반지름 증가
					shadow: 32 + Math.random() * 32 // 그림자 효과 강화
				});
			}
			fireworks.push({particles});
		}

		function drawFireworks() {
			ctx.clearRect(0, 0, fwCanvas.width, fwCanvas.height);
			for (let fw of fireworks) {
				for (let p of fw.particles) {
					ctx.save();
					ctx.globalAlpha = p.alpha;
					ctx.beginPath();
					ctx.arc(p.x, p.y, p.radius, 0, 2 * Math.PI);
					ctx.fillStyle = p.color;
					ctx.shadowColor = p.color;
					ctx.shadowBlur = p.shadow;
					ctx.fill();
					ctx.restore();
				}
			}
		}

		function updateFireworks() {
			for (let fw of fireworks) {
				for (let p of fw.particles) {
					p.x += p.vx;
					p.y += p.vy;
					p.vy += 0.08; // gravity 약간 증가
					p.vx *= 0.97;
					p.vy *= 0.97;
					p.alpha *= 0.96; // 느리게 사라지게
				}
			}
			fireworks = fireworks.filter(fw =>
				fw.particles.some(p => p.alpha > 0.04)
			);
		}

		function animateFireworks() {
			updateFireworks();
			drawFireworks();
			if (fireworks.length > 0 || fireworkInterval) {
				requestAnimationFrame(animateFireworks);
			} else {
				fwCanvas.style.display = 'none';
			}
		}

		function startFireworks() {
			resizeCanvas();
			fwCanvas.style.display = 'block';
			fireworks = [];
			if (fireworkInterval) clearInterval(fireworkInterval);
			// 더 자주, 더 많이 발사
			fireworkInterval = setInterval(() => {
				for (let i = 0; i < 4; i++) launchFirework();
			}, 120); // 0.12초마다 여러개
			animateFireworks();
			if (fireworkEndTimeout) clearTimeout(fireworkEndTimeout);
			fireworkEndTimeout = setTimeout(() => {
				clearInterval(fireworkInterval);
				fireworkInterval = null;
				setTimeout(() => {
					fireworks = [];
					fwCanvas.style.display = 'none';
				}, 1200);
			}, 5000); // 5초간 연출
		}

		document.getElementById('stopBtn').onclick = stopTimer;

		document.getElementById('retryBtn').onclick = function() {
			clearTimeout(timerTimeout);
			document.getElementById('timer').textContent = '0.00';
			document.getElementById('result').textContent = '';
			document.getElementById('stopBtn').disabled = false;
			if (fireworkInterval) clearInterval(fireworkInterval);
			if (fireworkEndTimeout) clearTimeout(fireworkEndTimeout);
			fireworks = [];
			fwCanvas.style.display = 'none';
			startTimer();
		};

		// 스페이스바로 멈추기
		window.addEventListener('keydown', function(e) {
			if (e.code === 'Space' && !stopped) {
				e.preventDefault();
				stopTimer();
			}
		});

		// 타이머 시작
		window.onload = function() {
			document.getElementById('stopBtn').disabled = false;
			startTimer();
		};
	</script>
</body>
</html>

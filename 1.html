<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>7초 타이머 도전</title>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
			font-family: 'Segoe UI', Arial, sans-serif;
		}
		.container {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			width: 100vw;
			height: 100vh;
			background: rgba(255,255,255,0.13);
		}
		.timer {
			font-size: 3.2em;
			font-weight: bold;
			color: #222;
			margin-bottom: 32px;
			letter-spacing: 2px;
			text-shadow: 0 2px 8px #fff6;
		}
		.result {
			font-size: 1.5em;
			font-weight: bold;
			margin-top: 28px;
			color: #e53935;
			min-height: 2em;
		}
		.stop-btn {
			background: linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%);
			color: #fff;
			border: none;
			border-radius: 8px;
			padding: 16px 48px;
			font-size: 1.2em;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 8px #0002;
			transition: background 0.2s, transform 0.1s;
		}
		.stop-btn:active {
			background: linear-gradient(90deg, #6dd5ed 0%, #2193b0 100%);
			transform: scale(0.97);
		}
	</style>
</head>
<body>
	<div class="container">
		<canvas id="confetti" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;display:none;"></canvas>
		<div class="timer" id="timer">0.00</div>
		<button class="stop-btn" id="stopBtn">멈추기</button>
		<button class="stop-btn" id="retryBtn" style="margin-top:12px; background:linear-gradient(90deg,#43e97b 0%,#38f9d7 100%);">다시하기</button>
		<div class="result" id="result"></div>
	</div>
	<script>
		let startTime = null;
		let timerTimeout = null;
		let stopped = false;

		function pad(num, len) {
			return num.toString().padStart(len, '0');
		}

		function updateTimer() {
			if (stopped) return;
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed >= 10) {
				elapsed = 10;
				document.getElementById('timer').textContent = '10.00';
				document.getElementById('result').textContent = '시간초과';
				document.getElementById('stopBtn').disabled = true;
				return;
			}
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			timerTimeout = setTimeout(updateTimer, 1); // 더 빠른 갱신
		}

		function startTimer() {
			startTime = performance.now();
			stopped = false;
			document.getElementById('result').textContent = '';
			document.getElementById('result').style.color = '#e53935';
			document.getElementById('stopBtn').disabled = false;
			updateTimer();
		}

		function stopTimer() {
			if (stopped) return;
			stopped = true;
			clearTimeout(timerTimeout);
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed > 10) elapsed = 10;
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			document.getElementById('stopBtn').disabled = true;
			if (sec === 7 && ms === 0) {
				document.getElementById('result').textContent = '성공!';
				document.getElementById('result').style.color = '#388e3c';
				startConfetti();
			} else {
				document.getElementById('result').textContent = '실패';
				document.getElementById('result').style.color = '#e53935';
			}
		}

		// 종이띠(컨페티) 효과 구현
		const confettiCanvas = document.getElementById('confetti');
		const confettiCtx = confettiCanvas.getContext('2d');
		let confettiPieces = [];
		let confettiAnimFrame = null;
		let confettiEndTimeout = null;

		function resizeConfettiCanvas() {
			confettiCanvas.width = window.innerWidth;
			confettiCanvas.height = window.innerHeight;
		}
		window.addEventListener('resize', resizeConfettiCanvas);

		function randomBetween(a, b) {
			return a + Math.random() * (b - a);
		}

		function createConfettiPiece() {
			const colors = [
				'#2196f3', '#e53935', '#43a047', '#ffd600', '#ff6f00', '#8e24aa', '#00bcd4', '#ff4081', '#fff', '#00e676'
			];
			const w = confettiCanvas.width;
			const h = confettiCanvas.height;
			return {
				x: randomBetween(0, w),
				y: randomBetween(-h * 0.2, -20),
				width: randomBetween(8, 18),
				height: randomBetween(14, 28),
				color: colors[Math.floor(Math.random() * colors.length)],
				angle: randomBetween(0, 2 * Math.PI),
				angularSpeed: randomBetween(-0.03, 0.03),
				speed: randomBetween(2.5, 6),
				vy: randomBetween(2.5, 6),
				vx: randomBetween(-2, 2),
				gravity: randomBetween(0.08, 0.16),
				opacity: randomBetween(0.7, 1),
				tilt: randomBetween(-0.5, 0.5)
			};
		}

		function launchConfetti() {
			const count = 32 + Math.floor(Math.random() * 16); // 한 번에 여러 개
			for (let i = 0; i < count; i++) {
				confettiPieces.push(createConfettiPiece());
			}
		}

		function drawConfetti() {
			confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
			for (let c of confettiPieces) {
				confettiCtx.save();
				confettiCtx.globalAlpha = c.opacity;
				confettiCtx.translate(c.x, c.y);
				confettiCtx.rotate(c.angle);
				confettiCtx.fillStyle = c.color;
				confettiCtx.fillRect(-c.width/2, -c.height/2, c.width, c.height);
				confettiCtx.restore();
			}
		}

		function updateConfetti() {
			for (let c of confettiPieces) {
				c.x += c.vx;
				c.y += c.vy;
				c.vy += c.gravity;
				c.angle += c.angularSpeed;
				c.opacity *= 0.995;
			}
			// 화면 아래로 떨어진 것 제거
			confettiPieces = confettiPieces.filter(c =>
				c.y < confettiCanvas.height + 40 && c.opacity > 0.05
			);
		}

		function animateConfetti() {
			updateConfetti();
			drawConfetti();
			if (confettiPieces.length > 0) {
				confettiAnimFrame = requestAnimationFrame(animateConfetti);
			} else {
				confettiCanvas.style.display = 'none';
			}
		}

		function startConfetti() {
			resizeConfettiCanvas();
			confettiCanvas.style.display = 'block';
			confettiPieces = [];
			if (confettiAnimFrame) cancelAnimationFrame(confettiAnimFrame);
			// 5초간 여러 번 발사
			let interval = setInterval(() => {
				for (let i = 0; i < 4; i++) launchConfetti();
			}, 120);
			animateConfetti();
			if (confettiEndTimeout) clearTimeout(confettiEndTimeout);
			confettiEndTimeout = setTimeout(() => {
				clearInterval(interval);
				setTimeout(() => {
					confettiPieces = [];
					confettiCanvas.style.display = 'none';
				}, 1200);
			}, 5000);
		}

		document.getElementById('stopBtn').onclick = stopTimer;

		document.getElementById('retryBtn').onclick = function() {
			clearTimeout(timerTimeout);
			document.getElementById('timer').textContent = '0.00';
			document.getElementById('result').textContent = '';
			document.getElementById('stopBtn').disabled = false;
			// 컨페티 초기화
			if (confettiAnimFrame) cancelAnimationFrame(confettiAnimFrame);
			if (confettiEndTimeout) clearTimeout(confettiEndTimeout);
			confettiPieces = [];
			confettiCanvas.style.display = 'none';
			startTimer();
		};

		// 스페이스바로 멈추기
		window.addEventListener('keydown', function(e) {
			if (e.code === 'Space' && !stopped) {
				e.preventDefault();
				stopTimer();
			}
			// b 키로 강제 7초 성공
			if ((e.key === 'b' || e.key === 'B') && !stopped) {
				e.preventDefault();
				stopped = true;
				clearTimeout(timerTimeout);
				// 7.00초로 강제 설정
				document.getElementById('timer').textContent = '7.00';
				document.getElementById('stopBtn').disabled = true;
				document.getElementById('result').textContent = '성공!';
				document.getElementById('result').style.color = '#388e3c';
				startConfetti();
			}
		});

		// 타이머 시작
		window.onload = function() {
			document.getElementById('stopBtn').disabled = false;
			startTimer();
		};
	</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>블랙잭 게임</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #115c2b; /* 진한 초록색 */
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        h1 {
            margin-top: 40px;
            font-size: 2.5em;
            color: #ffd700;
        }
        .game-area {
            background: #333;
            border-radius: 16px;
            box-shadow: 0 4px 24px #0008;
            padding: 32px 24px;
            margin-top: 32px;
            min-width: 340px;
            max-width: 400px;
        }
        .cards {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }
        .card {
            background: #fff;
            color: #222;
            border-radius: 8px;
            width: 48px;
            height: 72px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 2px 8px #0004;
        }
        .score {
            font-size: 1.1em;
            margin-bottom: 12px;
        }
        .actions {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }
        button {
            background: #ffd700;
            color: #222;
            border: none;
            border-radius: 6px;
            padding: 10px 24px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:active {
            background: #e6c200;
        }
        .result {
            font-size: 1.2em;
            margin-top: 18px;
            color: #ff5252;
        }
    </style>
</head>
<body>
    <h1>블랙잭 게임</h1>
    <div class="game-area">
        <div>
            <strong>딜러 카드</strong>
            <div class="cards" id="dealer-cards"></div>
            <div class="score" id="dealer-score"></div>
        </div>
        <hr>
        <!-- 3명의 플레이어 영역 추가 -->
        <div id="players-area">
            <div>
                <strong>플레이어 1 카드</strong>
                <div class="cards" id="player1-cards"></div>
                <div class="score" id="player1-score"></div>
                <div class="actions" id="player1-actions"></div>
            </div>
            <hr>
            <div>
                <strong>플레이어 2 카드</strong>
                <div class="cards" id="player2-cards"></div>
                <div class="score" id="player2-score"></div>
                <div class="actions" id="player2-actions"></div>
            </div>
            <hr>
            <div>
                <strong>플레이어 3 카드</strong>
                <div class="cards" id="player3-cards"></div>
                <div class="score" id="player3-score"></div>
                <div class="actions" id="player3-actions"></div>
            </div>
        </div>
        <div class="result" id="result"></div>
        <div style="margin-top:16px;">
            <button id="restart">다시하기</button>
        </div>
    </div>
    <script>
        // 카드 덱 생성
        const suits = ['♠', '♥', '♦', '♣'];
        const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        function createDeck() {
            const deck = [];
            for (let suit of suits) {
                for (let value of values) {
                    deck.push({suit, value});
                }
            }
            return deck;
        }
        function shuffle(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        // 3명의 플레이어 지원
        let deck, dealerCards, players, currentPlayer, gameOver;

        function startGame() {
            deck = createDeck();
            shuffle(deck);
            dealerCards = [deck.pop(), deck.pop()];
            players = [
                {cards: [deck.pop(), deck.pop()], stand: false, bust: false, blackjack: false, aceChoice: []},
                {cards: [deck.pop(), deck.pop()], stand: false, bust: false, blackjack: false, aceChoice: []},
                {cards: [deck.pop(), deck.pop()], stand: false, bust: false, blackjack: false, aceChoice: []}
            ];
            currentPlayer = 0;
            gameOver = false;
            document.getElementById('result').textContent = '';
            updateUI();
        }

        // A(에이스) 선택 UI 생성
        function showAceChoice(playerIdx, cardIdx) {
            const actionsDiv = document.getElementById(`player${playerIdx+1}-actions`);
            actionsDiv.innerHTML = '';
            const btn1 = document.createElement('button');
            btn1.textContent = 'A를 1로';
            btn1.onclick = () => {
                players[playerIdx].aceChoice[cardIdx] = 1;
                updateUI();
            };
            const btn11 = document.createElement('button');
            btn11.textContent = 'A를 11로';
            btn11.onclick = () => {
                players[playerIdx].aceChoice[cardIdx] = 11;
                updateUI();
            };
            actionsDiv.appendChild(btn1);
            actionsDiv.appendChild(btn11);
        }

        // 카드 값 계산 (A 선택 반영)
        function cardValue(card, aceChoice) {
            if (card.value === 'A') {
                return aceChoice ? aceChoice : 11;
            }
            if (['K', 'Q', 'J'].includes(card.value)) return 10;
            return parseInt(card.value);
        }
        function calculateScore(cards, aceChoices) {
            let score = 0;
            let aces = 0;
            for (let i = 0; i < cards.length; i++) {
                const card = cards[i];
                if (card.value === 'A') {
                    score += cardValue(card, aceChoices[i]);
                    aces++;
                } else {
                    score += cardValue(card);
                }
            }
            // 기존 자동 A 처리 제거 (직접 선택)
            return score;
        }

        function updateUI() {
            // 딜러 카드 표시
            const dealerCardsDiv = document.getElementById('dealer-cards');
            dealerCardsDiv.innerHTML = '';
            dealerCards.forEach((card, idx) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                if (!gameOver && idx === 0 && players.some(p=>!p.stand && !p.bust)) {
                    cardDiv.textContent = '🂠'; // 첫 카드 숨김
                } else {
                    cardDiv.textContent = card.value + card.suit;
                }
                dealerCardsDiv.appendChild(cardDiv);
            });
            // 딜러 점수 표시
            const dealerScoreDiv = document.getElementById('dealer-score');
            if (!gameOver && players.some(p=>!p.stand && !p.bust)) {
                dealerScoreDiv.textContent = '점수: ?';
            } else {
                dealerScoreDiv.textContent = '점수: ' + calculateScore(dealerCards, []);
            }
            // 각 플레이어 UI
            for (let i = 0; i < 3; i++) {
                const player = players[i];
                const playerCardsDiv = document.getElementById(`player${i+1}-cards`);
                playerCardsDiv.innerHTML = '';
                player.cards.forEach((card, idx) => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.textContent = card.value + card.suit;
                    playerCardsDiv.appendChild(cardDiv);
                });
                // 점수 표시
                document.getElementById(`player${i+1}-score`).textContent =
                    '점수: ' + calculateScore(player.cards, player.aceChoice);

                // 액션 버튼
                const actionsDiv = document.getElementById(`player${i+1}-actions`);
                actionsDiv.innerHTML = '';
                if (gameOver || player.stand || player.bust) continue;
                if (currentPlayer === i) {
                    // A 선택이 필요한 카드가 있으면 선택 UI
                    let aceIdx = player.cards.findIndex((c, idx) => c.value === 'A' && player.aceChoice[idx] == null);
                    if (aceIdx !== -1) {
                        showAceChoice(i, aceIdx);
                    } else {
                        // 히트/스탠드 버튼
                        const hitBtn = document.createElement('button');
                        hitBtn.textContent = '히트';
                        hitBtn.onclick = function() {
                            player.cards.push(deck.pop());
                            player.aceChoice.push(undefined);
                            updateUI();
                            checkGameEnd();
                        };
                        const standBtn = document.createElement('button');
                        standBtn.textContent = '스탠드';
                        standBtn.onclick = function() {
                            player.stand = true;
                            nextPlayer();
                        };
                        actionsDiv.appendChild(hitBtn);
                        actionsDiv.appendChild(standBtn);
                    }
                }
            }
        }

        function checkGameEnd() {
            const player = players[currentPlayer];
            const score = calculateScore(player.cards, player.aceChoice);
            if (score > 21) {
                player.bust = true;
                player.stand = true;
                nextPlayer();
                return;
            }
            if (score === 21 && player.cards.length === 2) {
                player.blackjack = true;
                player.stand = true;
                nextPlayer();
                return;
            }
            updateUI();
        }

        function nextPlayer() {
            // 다음 플레이어로 이동
            currentPlayer++;
            if (currentPlayer >= players.length) {
                dealerTurn();
            } else {
                updateUI();
            }
        }

        function dealerTurn() {
            // 모든 플레이어가 끝나면 딜러 턴
            let dealerScore = calculateScore(dealerCards, []);
            while (dealerScore < 17) {
                dealerCards.push(deck.pop());
                dealerScore = calculateScore(dealerCards, []);
            }
            gameOver = true;
            updateUI();
            setTimeout(() => {
                showResult();
            }, 800);
        }

        function showResult() {
            const dealerScore = calculateScore(dealerCards, []);
            let resultText = '';
            for (let i = 0; i < 3; i++) {
                const player = players[i];
                const score = calculateScore(player.cards, player.aceChoice);
                let result = '';
                if (player.bust) {
                    result = `플레이어 ${i+1}: 버스트! 딜러 승리`;
                } else if (player.blackjack) {
                    result = `플레이어 ${i+1}: 블랙잭! 승리`;
                } else if (dealerScore > 21) {
                    result = `플레이어 ${i+1}: 딜러 버스트! 승리`;
                } else if (score > dealerScore) {
                    result = `플레이어 ${i+1}: 승리!`;
                } else if (score === dealerScore) {
                    result = `플레이어 ${i+1}: 무승부`;
                } else {
                    result = `플레이어 ${i+1}: 딜러 승리`;
                }
                resultText += result + '\n';
            }
            document.getElementById('result').textContent = resultText;
        }

        document.getElementById('restart').onclick = function() {
            startGame();
        };

        // 최초 시작
        startGame();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<title>7초 타이머 도전</title>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}
		body {
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
			font-family: 'Segoe UI', Arial, sans-serif;
		}
		.container {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			width: 100vw;
			height: 100vh;
			background: rgba(255,255,255,0.13);
		}
		.timer {
			font-size: 3.2em;
			font-weight: bold;
			color: #222;
			margin-bottom: 32px;
			letter-spacing: 2px;
			text-shadow: 0 2px 8px #fff6;
		}
		.result {
			font-size: 1.5em;
			font-weight: bold;
			margin-top: 28px;
			color: #e53935;
			min-height: 2em;
		}
		.stop-btn {
			background: linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%);
			color: #fff;
			border: none;
			border-radius: 8px;
			padding: 16px 48px;
			font-size: 1.2em;
			font-weight: bold;
			cursor: pointer;
			box-shadow: 0 2px 8px #0002;
			transition: background 0.2s, transform 0.1s;
		}
		.stop-btn:active {
			background: linear-gradient(90deg, #6dd5ed 0%, #2193b0 100%);
			transform: scale(0.97);
		}
	</style>
</head>
<body>
	<div class="container">
		<canvas id="confetti" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999;display:none;"></canvas>
		<div class="timer" id="timer">0.00</div>
		<button class="stop-btn" id="stopBtn">멈추기</button>
		<button class="stop-btn" id="retryBtn" style="margin-top:12px; background:linear-gradient(90deg,#43e97b 0%,#38f9d7 100%);">다시하기</button>
		<div class="result" id="result"></div>
	</div>
	<script>
		let startTime = null;
		let timerTimeout = null;
		let stopped = false;

		function pad(num, len) {
			return num.toString().padStart(len, '0');
		}

		function updateTimer() {
			if (stopped) return;
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed >= 10) {
				elapsed = 10;
				document.getElementById('timer').textContent = '10.00';
				document.getElementById('result').textContent = '시간초과';
				document.getElementById('stopBtn').disabled = true;
				return;
			}
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			timerTimeout = setTimeout(updateTimer, 1); // 더 빠른 갱신
		}

		function startTimer() {
			startTime = performance.now();
			stopped = false;
			document.getElementById('result').textContent = '';
			document.getElementById('result').style.color = '#e53935';
			document.getElementById('stopBtn').disabled = false;
			updateTimer();
		}

		function stopTimer() {
			if (stopped) return;
			stopped = true;
			clearTimeout(timerTimeout);
			const now = performance.now();
			let elapsed = (now - startTime) / 1000;
			if (elapsed > 10) elapsed = 10;
			const sec = Math.floor(elapsed);
			const ms = Math.floor((elapsed - sec) * 100);
			document.getElementById('timer').textContent = `${sec}.${pad(ms,2)}`;
			document.getElementById('stopBtn').disabled = true;
			if (sec === 7 && ms === 0) {
				document.getElementById('result').textContent = '성공!';
				document.getElementById('result').style.color = '#388e3c';
				startFireworks();
			} else {
				document.getElementById('result').textContent = '실패';
				document.getElementById('result').style.color = '#e53935';
			}
		}

		// 폭죽(파이어웍스) 효과 구현
		const confettiCanvas = document.getElementById('confetti');
		const ctx = confettiCanvas.getContext('2d');
		let fireworks = [];
		let particles = [];
		let fireworksAnimFrame = null;
		let fireworksEndTimeout = null;

		function resizeFireworksCanvas() {
			confettiCanvas.width = window.innerWidth;
			confettiCanvas.height = window.innerHeight;
		}
		window.addEventListener('resize', resizeFireworksCanvas);

		function randomBetween(a, b) {
			return a + Math.random() * (b - a);
		}

		function launchFirework() {
			const w = confettiCanvas.width;
			const h = confettiCanvas.height;
			const x = randomBetween(w * 0.2, w * 0.8);
			const y = randomBetween(h * 0.15, h * 0.45);
			const color = `hsl(${Math.floor(Math.random()*360)},90%,60%)`;
			fireworks.push({
				x: x,
				y: h,
				tx: x,
				ty: y,
				color: color,
				state: 'ascend',
				vy: randomBetween(-13, -17),
				vx: randomBetween(-1, 1),
				particles: []
			});
		}

		function createParticles(firework) {
			const count = 48 + Math.floor(Math.random() * 32);
			for (let i = 0; i < count; i++) {
				const angle = (Math.PI * 2) * (i / count);
				const speed = randomBetween(2, 7);
				particles.push({
					x: firework.tx,
					y: firework.ty,
					vx: Math.cos(angle) * speed + randomBetween(-1,1),
					vy: Math.sin(angle) * speed + randomBetween(-1,1),
					gravity: 0.08,
					opacity: 1,
					color: firework.color,
					radius: randomBetween(2, 4)
				});
			}
		}

		function updateFireworks() {
			const h = confettiCanvas.height;
			for (let fw of fireworks) {
				if (fw.state === 'ascend') {
					fw.x += fw.vx;
					fw.y += fw.vy;
					fw.vy += 0.18;
					if (fw.y <= fw.ty) {
						fw.state = 'explode';
						createParticles(fw);
					}
				}
			}
			fireworks = fireworks.filter(fw => fw.state !== 'explode');
		}

		function updateParticles() {
			for (let p of particles) {
				p.x += p.vx;
				p.y += p.vy;
				p.vy += p.gravity;
				p.opacity *= 0.97;
			}
			particles = particles.filter(p => p.opacity > 0.05 && p.y < confettiCanvas.height + 40);
		}

		function drawFireworks() {
			ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
			// 폭죽 본체
			for (let fw of fireworks) {
				if (fw.state === 'ascend') {
					ctx.save();
					ctx.beginPath();
					ctx.arc(fw.x, fw.y, 3, 0, Math.PI*2);
					ctx.fillStyle = fw.color;
					ctx.shadowColor = fw.color;
					ctx.shadowBlur = 12;
					ctx.fill();
					ctx.restore();
				}
			}
			// 파티클
			for (let p of particles) {
				ctx.save();
				ctx.globalAlpha = p.opacity;
				ctx.beginPath();
				ctx.arc(p.x, p.y, p.radius, 0, Math.PI*2);
				ctx.fillStyle = p.color;
				ctx.shadowColor = p.color;
				ctx.shadowBlur = 16;
				ctx.fill();
				ctx.restore();
			}
		}

		function animateFireworks() {
			updateFireworks();
			updateParticles();
			drawFireworks();
			if (fireworks.length > 0 || particles.length > 0) {
				fireworksAnimFrame = requestAnimationFrame(animateFireworks);
			} else {
				confettiCanvas.style.display = 'none';
			}
		}

		function startFireworks() {
			resizeFireworksCanvas();
			confettiCanvas.style.display = 'block';
			fireworks = [];
			particles = [];
			if (fireworksAnimFrame) cancelAnimationFrame(fireworksAnimFrame);
			let interval = setInterval(() => {
				for (let i = 0; i < 2; i++) launchFirework();
			}, 320);
			animateFireworks();
			if (fireworksEndTimeout) clearTimeout(fireworksEndTimeout);
			fireworksEndTimeout = setTimeout(() => {
				clearInterval(interval);
				setTimeout(() => {
					fireworks = [];
					particles = [];
					confettiCanvas.style.display = 'none';
				}, 1800);
			}, 3500);
		}

		document.getElementById('stopBtn').onclick = stopTimer;

		document.getElementById('retryBtn').onclick = function() {
			clearTimeout(timerTimeout);
			document.getElementById('timer').textContent = '0.00';
			document.getElementById('result').textContent = '';
			document.getElementById('stopBtn').disabled = false;
			// 폭죽 초기화
			if (fireworksAnimFrame) cancelAnimationFrame(fireworksAnimFrame);
			if (fireworksEndTimeout) clearTimeout(fireworksEndTimeout);
			fireworks = [];
			particles = [];
			confettiCanvas.style.display = 'none';
			startTimer();
		};

		// 스페이스바로 멈추기
		window.addEventListener('keydown', function(e) {
			if (e.code === 'Space' && !stopped) {
				e.preventDefault();
				stopTimer();
			}
			// b 키로 강제 7초 성공
			if ((e.key === 'b' || e.key === 'B') && !stopped) {
				e.preventDefault();
				stopped = true;
				clearTimeout(timerTimeout);
				// 7.00초로 강제 설정
				document.getElementById('timer').textContent = '7.00';
				document.getElementById('stopBtn').disabled = true;
				document.getElementById('result').textContent = '성공!';
				document.getElementById('result').style.color = '#388e3c';
				startFireworks();
			}
		});

		// 타이머 시작
		window.onload = function() {
			document.getElementById('stopBtn').disabled = false;
			startTimer();
		};
	</script>
</body>
</html>
